{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="page-title-box">
            <h4 class="page-title mb-0" style="
                font-family: 'Arial', sans-serif;
                font-size: 22px;
                font-weight: bold;
                color: #607D8B;
                letter-spacing: 2px;
                margin-bottom: 20px;
                padding-bottom: 10px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            ">
                <span style="margin-left: 20px; margin-top: 50x;">Add Info</span>
            </h4>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        {{ form.non_field_errors }}

                        <!-- Pin Code -->
                        <div class="form-group">
                            <label for="id_pincode">Pin Code</label>
                            {{ form.pincode }}
                            {{ form.pincode.errors }}
                        </div>

                        <!-- District -->
                        <div class="form-group">
                            <label for="id_district">District</label>
                            {{ form.district }}
                            {{ form.district.errors }}
                        </div>

                        <!-- State -->
                        <div class="form-group">
                            <label for="id_state">State</label>
                            {{ form.state }}
                            {{ form.state.errors }}
                        </div>

                        <!-- Country -->
                        <div class="form-group">
                            <label for="id_country">Country</label>
                            {{ form.country }}
                            {{ form.country.errors }}
                        </div>

                        <!-- Street -->
                        <div class="form-group">
                            <label for="id_street">Street</label>
                            {{ form.street }}
                            {{ form.street.errors }}
                        </div>

                        <!-- Landmark -->
                        <div class="form-group">
                            <label for="id_landmark">Landmark</label>
                            {{ form.landmark }}
                            {{ form.landmark.errors }}
                        </div>

                        <!-- Building -->
                        <div class="form-group">
                            <label>Building</label>
                            {{ form.building }}
                            {{ form.building.errors }}
                        </div>

                        <!-- Id Proof Type -->
                        <div class="form-group">
                            <label>Id Proof Types</label>
                            {{ form.id_proof_type }}
                            {{ form.id_proof_type.errors }}
                        </div>

                        <!-- Other Id Proof -->
                        <div class="form-group" id="other-id-proof" style="display:none;">
                            <label>Other Id Proof Type</label>
                            {{ form.other_id_proof_type }}
                            {{ form.other_id_proof_type.errors }}
                        </div>

                        <!-- Id Proof Number -->
                        <div class="form-group">
                            <label>Id Proof Types Number</label>
                            {{ form.id_proof_type_number }}
                            {{ form.id_proof_type_number.errors }}
                        </div>

                        <!-- Id Proof File -->
                        <div class="form-group">
                            <label>Id Proof File</label>
                            {% if form.id_proof_file.value %}
                                <p>Current file: <a href="{{ form.id_proof_file.value.url }}">{{ form.id_proof_file.value.name }}</a></p>
                            {% endif %}
                            {{ form.id_proof_file }}
                            {{ form.id_proof_file.errors }}
                        </div>

                        <!-- Blood Group -->
                        <div class="form-group">
                            <label>Blood Group</label>
                            {{ form.employee_blood_groups }}
                            {{ form.employee_blood_groups.errors }}
                        </div>

                        <!-- Date of Birth -->
                        <div class="form-group">
                            <label>Date of Birth</label>
                            {{ form.date_of_birth }}
                            {{ form.date_of_birth.errors }}
                        </div>

                        <!-- Qualification -->
                        <div class="form-group">
                            <label>Qualification</label>
                            {{ form.qualification }}
                            {{ form.qualification.errors }}
                        </div>

                        <!-- Qualification Proof -->
                        <div class="form-group">
                            <label>Qualification Proof</label>
                            {% if form.qualification_file.value %}
                                <p>Current file: <a href="{{ form.qualification_file.value.url }}">{{ form.qualification_file.value.name }}</a></p>
                            {% endif %}
                            {{ form.qualification_file }}
                            {{ form.qualification_file.errors }}
                        </div>

                        <!-- Experience -->
                        <div class="form-group">
                            <label>Experience</label>
                            {{ form.experience }}
                            {{ form.experience.errors }}
                        </div>

                        <!-- Experience Proof -->
                        <div class="form-group">
                            <label>Experience Proof</label>
                            {% if form.experience_file.value %}
                                <p>Current file: <a href="{{ form.experience_file.value.url }}">{{ form.experience_file.value.name }}</a></p>
                            {% endif %}
                            {{ form.experience_file }}
                            {{ form.experience_file.errors }}
                        </div>

                        <!-- Joining Date -->
                        <div class="form-group">
                            <label>Joining Date</label>
                            {{ form.joining_date }}
                            {{ form.joining_date.errors }}
                        </div>

                        <!-- NSR -->
                        <div class="form-group">
                            <label>NSR</label>
                            {% if form.nsr.value %}
                                <p>Current file: <a href="{{ form.nsr.value.url }}">{{ form.nsr.value.name }}</a></p>
                            {% endif %}
                            {{ form.nsr }}
                            {{ form.nsr.errors }}
                        </div>

                        <!-- PCC -->
                        <div class="form-group">
                            <label>PCC</label>
                            {% if form.pcc.value %}
                                <p>Current file: <a href="{{ form.pcc.value.url }}">{{ form.pcc.value.name }}</a></p>
                            {% endif %}
                            {{ form.pcc }}
                            {{ form.pcc.errors }}
                        </div>

                        <!-- Gender -->
                        <div class="form-group">
                            <label>Gender</label>
                            {{ form.gender }}
                            {{ form.gender.errors }}
                        </div>

                        <!-- Resume -->
                        <div class="form-group">
                            <label>Resume</label>
                            {% if form.resume.value %}
                                <p>Current file: <a href="{{ form.resume.value.url }}">{{ form.resume.value.name }}</a></p>
                            {% endif %}
                            {{ form.resume }}
                            {{ form.resume.errors }}
                        </div>

                        <!-- Bank Details -->
                        <div class="form-group">
                            <label>Bank Details</label>
                            {% if form.bank_details.value %}
                                <p>Current file: <a href="{{ form.bank_details.value.url }}">{{ form.bank_details.value.name }}</a></p>
                            {% endif %}
                            {{ form.bank_details }}
                            {{ form.bank_details.errors }}
                        </div>

                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://unpkg.com/htmx.org@1.8.0"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Handle Pincode Autofill
        $('#id_pincode').on('input', function() {
            var pincode = $(this).val();
            if (pincode.length === 6) {
                $.ajax({
                    url: 'https://api.postalpincode.in/pincode/' + pincode,
                    method: 'GET',
                    success: function(response) {
                        if (response[0].Status === 'Success') {
                            var postOffice = response[0].PostOffice[0];
                            $('#id_district').val(postOffice.District);
                            $('#id_state').val(postOffice.State);
                            $('#id_street').val(postOffice.Name);
                            $('#id_country').val('India');
                        } else {
                            alert('Invalid Pincode');
                        }
                    },
                    error: function() {
                        alert('Error fetching details. Please try again later.');
                    }
                });
            }
        });

        // Toggle Other ID Proof Fields
        $('#id_id_proof_type').on('change', function() {
            if ($(this).val() === 'OTHERS') {
                $('#other-id-proof').show();
            } else {
                $('#other-id-proof').hide();
            }
        });
    });
</script>
{% endblock %}